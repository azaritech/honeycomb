<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/hex/prototype.js | honeycomb-grid</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Create hexagon grids easily. Written in javascript."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="honeycomb-grid"><meta property="twitter:description" content="Create hexagon grids easily. Written in javascript."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/flauwekeul/honeycomb"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-COMPASS_DIRECTION">COMPASS_DIRECTION</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#grid">grid</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-get">get</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-hexesBetween">hexesBetween</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setFactory">setFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-grid">grid</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#hex">hex</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-extendHexFactory">extendHexFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cartesianToCube">cartesianToCube</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-coordinates">coordinates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cube">cube</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cubeToCartesian">cubeToCartesian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-distance">distance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-equalsFactory">equalsFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-height">height</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isFlat">isFlat</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isPointy">isPointy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nudge">nudge</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-oppositeCornerDistance">oppositeCornerDistance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-oppositeSideDistance">oppositeSideDistance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-toString">toString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-width">width</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-thirdCoordinate">thirdCoordinate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DIAGONAL_DIRECTION_COORDINATES">DIAGONAL_DIRECTION_COORDINATES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DIRECTION_COORDINATES">DIRECTION_COORDINATES</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-EPSILON">EPSILON</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-OFFSET">OFFSET</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ORIENTATION">ORIENTATION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-staticMethods">staticMethods</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-hex">hex</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#point">point</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PointFactory">PointFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addFactory">addFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-divideFactory">divideFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-multiplyFactory">multiplyFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-subtractFactory">subtractFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-point">point</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/hex/prototype.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { ORIENTATION, EPSILON } from &apos;./constants&apos;
import { offsetFromZero } from &apos;../utils&apos;

const sqrt3 = Math.sqrt(3)

/**
 * @private
 */
export function setFactory({ Hex }) {
    /**
     * @memberof Hex#
     * @instance
     *
     * @param {*} coordinates   Same parameters as the {@link Hex} factory.
     * @returns {hex}           Itself with the passed parameters merged into it.
     *
     * @example
     * const Hex = Honeycomb.extendHex()
     *
     * const hex = Hex({ x: 1, y: 2, a: 3, b: 4 })          // { a: 3, b: 4, x: 1, y: 2 }
     * const updatedHex = hex.set({ x: 0, y: -1, b: 5 })    // { a: 3, b: 5, x: 0, y: -1 }
     * hex === updatedHex                                   // true: hex is updated in-place
     */
    return function set(...args) {
        return Object.assign(this, Hex(...args))
    }
}

/**
 * @memberof Hex#
 * @returns {Object}    The hex&apos;s cartesian `x` and `y` coordinates.
 *
 * @example
 * const Hex = Honeycomb.extendHex()
 *
 * Hex().coordinates()      // { x: 0, y: 0 }
 * Hex(1, 2).coordinates()  // { x: 1, y: 2 }
 */
export function coordinates() {
    return { x: this.x, y: this.y }
}

/**
 * @memberof Hex#
 * @returns {Object}    The hex&apos;s cube `q`, `r` and `s` coordinates.
 *
 * @example
 * const Hex = Honeycomb.extendHex()
 *
 * Hex().cube()     // { q: 0, r: 0, s: 0 }
 * Hex(1, 2).cube() // { q: 0, r: 2, s: -2 }
 */
export function cube() {
    return { q: this.q, r: this.r, s: this.s }
}

/**
 * @memberof Hex#
 *
 * @todo make this a static (and instance?) method
 *
 * @param {Object} cubeCoordinates      At least the `q` and `r` cube coordinates.
 * @param {number} cubeCoordinates.q    The `q` cube coordinate.
 * @param {number} cubeCoordinates.r    The `r` cube coordinate.
 * @param {number} [cubeCoordinates.s]  The optional `s` cube coordinate.
 *
 * @returns {Object}                    The hex&apos;s cartesian `x` and `y` coordinates.
 *
 * @example
 * const Hex = Honeycomb.extendHex()
 *
 * Hex().cubeToCartesian({ q: 1, r: 2, s: -3 }) // { x: 2, y: 2 }
 * // the `s` coordinate isn&apos;t required:
 * Hex().cubeToCartesian({ q: -3, r: 5 })       // { x: -1, y: 5 }
 */
export function cubeToCartesian({ q, r }) {
    let x, y

    if (this.isPointy()) {
        x = q + offsetFromZero(this.offset, r)
        y = r
    } else {
        x = q
        y = r + offsetFromZero(this.offset, q)
    }

    return { x, y }
}

/**
 * @memberof Hex#
 *
 * @todo make this a static (and instance?) method
 *
 * @param {Object} cartesianCoordinates     The `x` and `y` cartesian coordinate.
 * @param {number} cartesianCoordinates.x   The `x` cartesian coordinate.
 * @param {number} cartesianCoordinates.y   The `y` cartesian coordinate.
 *
 * @returns {Object}                        The hex&apos;s cube `q`, `r` and `s` coordinates.
 *
 * @example
 * const Hex = Honeycomb.extendHex()
 *
 * Hex().cartesianToCube({ x: 4, y: -2 }) // { q: 5, r: -2, s: -3 }
 */
export function cartesianToCube({ x, y }) {
    let q, r

    if (this.isPointy()) {
        q = x - offsetFromZero(this.offset, y)
        r = y
    } else {
        q = x
        r = y - offsetFromZero(this.offset, x)
    }

    return { q, r, s: -q - r }
}
/**
 * @memberof Hex#
 * @returns {boolean}   Whether hexes have a pointy &#x2B22; orientation.
 */
export function isPointy() {
    return this.orientation.toLowerCase() === ORIENTATION.pointy
}

/**
 * @memberof Hex#
 * @returns {boolean}   Whether hexes have a flat &#x2B23; orientation.
 */
export function isFlat() {
    return this.orientation.toLowerCase() === ORIENTATION.flat
}

/**
 * @memberof Hex#
 * @returns {number}    The distance between opposite corners of a hex.
 */
export function oppositeCornerDistance() {
    return this.size * 2
}

/**
 * @memberof Hex#
 * @returns {number}    The distance between opposite sides of a hex.
 */
export function oppositeSideDistance() {
    return sqrt3 / 2 * this.oppositeCornerDistance()
}

/**
 * @memberof Hex#
 * @returns {number}    The (horizontal) width of a hex.
 */
export function width() {
    return this.isPointy() ?
        this.oppositeSideDistance() :
        this.oppositeCornerDistance()
}

/**
 * @memberof Hex#
 * @returns {number}    The (vertical) height of a hex.
 */
export function height() {
    return this.isPointy() ?
        this.oppositeCornerDistance() :
        this.oppositeSideDistance()
}

/**
 * @private
 */
export function cornersFactory({ Point }) {
    /**
     * @memberof Hex#
     * @instance
     * @returns {point[]}
     * Array of corner points relative to the {@link Hex#origin|hex&apos;s origin}.
     * Starting at the top right corner for pointy hexes and the right corner for flat hexes.
     *
     * @example
     * // a hex&apos;s origin defaults to its top left corner (as if it&apos;s a rectangle)
     * const Hex1 = Honeycomb.extendHex({ size: 30 })
     * Hex1().corners() // [
     *                  //    { x: 51.96152422706631, y: 15 },
     *                  //    { x: 51.96152422706631, y: 45 },
     *                  //    { x: 25.980762113533157, y: 60 },
     *                  //    { x: 0, y: 45 },
     *                  //    { x: 0, y: 15 },
     *                  //    { x: 25.980762113533157, y: 0 }
     *                  // ]
     *
     * // set the origin to a hex&apos;s center
     * const Hex2 = Honeycomb.extendHex({ size: 30, origin: [25.980762113533157, 30] })
     * Hex2().corners() // [
     *                  //    { x: 25.980762113533157, y: -15 },
     *                  //    { x: 25.980762113533157, y: 15 },
     *                  //    { x: 0, y: 30 },
     *                  //    { x: -25.980762113533157, y: 15 },
     *                  //    { x: -25.980762113533157, y: -15 },
     *                  //    { x: 0, y: -30 }
     *                  // ]
     */
    return function corners() {
        const width = this.width()
        const height = this.height()
        const { x, y } = this.origin

        if (this.isPointy()) {
            return [
                Point(width - x, height * 0.25 - y),
                Point(width - x, height * 0.75 - y),
                Point(width * 0.5 - x, height - y),
                Point(0 - x, height * 0.75 - y),
                Point(0 - x, height * 0.25 - y),
                Point(width * 0.5 - x, 0 - y)
            ]
        } else {
            return [
                Point(width - x, height * 0.5 - y),
                Point(width * 0.75 - x, height - y),
                Point(width * 0.25 - x, height - y),
                Point(0 - x, height * 0.5 - y),
                Point(width * 0.25 - x, 0 - y),
                Point(width * 0.75 - x, 0 - y)
            ]
        }
    }
}

/**
 * @private
 */
export function centerFactory({ Point }) {
    /**
     * @memberof Hex#
     * @instance
     * @returns {point} Point relative to the {@link Hex#origin|hex&apos;s origin}.
     * Note that the default origin is the top left corner, so the default center is
     * `{ x: hexWidth / 2, y: hexHeight / 2 }`.
     *
     * @example
     * const Hex1 = Honeycomb.extendHex({ size: 10 })
     * Hex1().center()  // { x: 8.660254037844386, y: 10 }
     *
     * const Hex2 = Honeycomb.extendHex({ size: 10, origin: [5, 5] })
     * Hex2().center()  // { x: 3.6602540378443855, y: 5 }
     */
    return function center() {
        const { x, y } = this.origin
        return Point(this.width() / 2 - x, this.height() / 2 - y)
    }
}

/**
 * @private
 */
export function toPointFactory({ Point }) {
    /**
     * @memberof Hex#
     * @instance
     * @returns {point} The hex&apos;s origin point.
     *
     * @example
     * const Hex = Honeycomb.extendHex({ size: 30 })
     * Hex().toPoint()          // { x: 0, y: 0 }
     * Hex(-2, -5).toPoint()    // { x: -77.94228634059947, y: -225 }
     */
    return function toPoint() {
        const { q, r, size } = this
        let x, y

        if (this.isPointy()) {
            x = size * sqrt3 * (q + r / 2)
            y = size * 3/2 * r
        } else {
            x = size * 3/2 * q
            y = size * sqrt3 * (r + q / 2)
        }

        return Point(x, y)
    }
}

/**
 * @private
 */
export function addFactory({ Hex, Point }) {
    /**
     * @memberof Hex#
     * @instance
     *
     * @todo Accept any number of hexes to add.
     *
     * @param {point} point The hex (or point) that will be added to the current.
     * @returns {hex}       A *new* hex where the passed hex&apos;s coordinates are added to the current.
     *                      Any custom properties are copied.
     */
    return function add(point) {
        const { x, y } = Point(point)
        // use call() to bind any custom properties to Hex(), which get merged into the resulting hex.
        return Hex.call(
            this,
            this.x + x,
            this.y + y
        )
    }
}

/**
 * @private
 */
export function subtractFactory({ Hex, Point }) {
    /**
     * @memberof Hex#
     * @instance
     *
     * @todo Accept any number of hexes to subtract.
     *
     * @param {point} point The hex (or point) that will be subtracted from the current.
     * @returns {hex}       A *new* hex where the passed hex&apos;s coordinates are subtracted from the current.
     *                      Any custom properties are copied.
     */
    return function subtract(point) {
        const { x, y } = Point(point)
        // use call() to bind any custom properties to Hex(), which get merged into the resulting hex.
        return Hex.call(
            this,
            this.x - x,
            this.y - y
        )
    }
}

export function equalsFactory({ Point }) {
    /**
     * @memberof Hex#
     * @instance
     *
     * @param {point} point The hex (or point) whose coordinates will be compared against the current hex.
     * @returns {boolean}   Whether the coordinates of the current and the passed point are equal.
     */
    return function equals(point) {
        const { x, y } = Point(point)
        return this.x === x &amp;&amp; this.y === y
    }
}

/**
 * @memberof Hex#
 *
 * @see {@link https://www.redblobgames.com/grids/hexagons/#distances|redblobgames.com}
 *
 * @param   {hex} hex   The last hex (cannot be a {@link point}).
 * @returns {number}    The amount of hexes from the current to (and excluding) the last hex.
 *
 * @example
 * const Hex = Honeycomb.extendHex()
 *
 * Hex().distance(Hex(1, 0))        // 1
 * Hex(-2, -2).distance(Hex(4, 1))  // 8
 */
export function distance(hex) {
    return Math.max(
        Math.abs(this.q - hex.q),
        Math.abs(this.r - hex.r),
        Math.abs(this.s - hex.s)
    )
}

/**
 * @private
 */
export function roundFactory({ Hex }) {
    /**
     * Rounds the current floating point hex coordinates to their nearest integer hex coordinates.
     *
     * @memberof Hex#
     * @see {@link https://www.redblobgames.com/grids/hexagons/#rounding|redblobgames.com}
     *
     * @returns {hex}   A *new* hex with rounded coordinates.
     *                  Any custom properties are copied.
     *
     * @example
     * const Hex = Honeycomb.extendHex()
     * Hex(3.1415, 0.5).round() // { x: 3, y: 1 }
     */
    return function round() {
        let { q, r, s } = this
        let roundedQ = Math.round(q)
        let roundedR = Math.round(r)
        let roundedS = Math.round(s)
        const diffQ = Math.abs(q - roundedQ)
        const diffR = Math.abs(r - roundedR)
        const diffS = Math.abs(s - roundedS)

        if (diffQ &gt; diffR &amp;&amp; diffQ &gt; diffS) {
            roundedQ = -roundedR - roundedS
        } else if (diffR &gt; diffS) {
            roundedR = -roundedQ - roundedS
        } else {
            roundedS = -roundedQ - roundedR
        }

        // use call() to bind any custom properties to Hex(), which get merged into the resulting hex.
        return Hex.call(this, { q: roundedQ, r: roundedR, s: roundedS })
    }
}

/**
 * @private
 */
export function lerpFactory({ Hex }) {
    /**
     * Returns an interpolation between the current hex and the passed hex for a `t` between 0 and 1.
     * More info on [wikipedia](https://en.wikipedia.org/wiki/Linear_interpolation).
     *
     * @memberof Hex#
     *
     * @param   {hex} hex   The other hex (cannot be a {@link point}).
     * @param   {number} t  A &quot;parameter&quot; between 0 and 1.
     *
     * @returns {hex}       A new hex (likely with floating point coordinates).
     *                      Any custom properties are copied.
     */
    return function lerp(hex, t) {
        const q = this.q * (1 - t) + hex.q * t
        const r = this.r * (1 - t) + hex.r * t
        // use call() to bind any custom properties to Hex(), which get merged into the resulting hex.
        return Hex.call(this, { q, r, s: -q - r })
    }
}

/**
 * @memberof Hex#
 * @see {@link https://www.redblobgames.com/grids/hexagons/#line-drawing|redblobgames.com}
 *
 * @returns {hex}   A *new* hex with a tiny offset from the current hex.
 *                  Useful for interpolating in a consistent direction.
 */
export function nudge() {
    return this.add(EPSILON)
}

/**
 * @memberof Hex#
 * @returns {string}    A string representation of the hex.
 */
export function toString() {
    return `${this.x},${this.y}`
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
